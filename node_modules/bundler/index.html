<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset=utf-8>
  <meta name="description" content="CSS is the University of Bristol Computer Science Society. We exist to represent, support and entertain all members of the Computer Science department.">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/assets/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/assets/favicons/manifest.json">
<link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#3498db">
<meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png">
<meta name="theme-color" content="#3498db">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Bundler - CSS Bristol">
<meta property="og:description" content="CSS is the University of Bristol Computer Science Society. We exist to represent, support and entertain all members of the Computer Science department.">
<meta property="og:image" content="https://cssbristol.co.uk/assets/images/core/og-image.png" />
<meta property="og:url" content="https://cssbristol.co.uk/node_modules/bundler/">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Bundler - CSS Bristol">
<meta name="twitter:description" content="CSS is the University of Bristol Computer Science Society. We exist to represent, support and entertain all members of the Computer Science department.">
<meta name="twitter:image" content="https://cssbristol.co.uk/assets/images/core/og-image.png">
<meta name="twitter:site" content="@cssbristol">
 

  <title>Bundler - CSS Bristol</title>
  <meta name="description" content="CSS is the University of Bristol Computer Science Society. We exist to represent, support and entertain all members of the Computer Science department.">


  <link rel="stylesheet" href="/assets/css/site.css" />
  <link rel="canonical" href="http://www.cssbristol.co.uk/node_modules/bundler/" />
  <link rel="alternate" type="application/rss+xml" title="CSS Bristol" href="http://www.cssbristol.co.uk/feed.xml" />

  <script src="https://kit.fontawesome.com/5918af34b4.js" crossorigin="anonymous"></script>

  <!-- FullCalendar -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.7.2/fullcalendar.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.7.2/fullcalendar.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.7.2/gcal.js"></script>

  <script type="text/javascript">
    $(function() {
      var images = ['header-bg-01.jpg', 'header-bg-02.jpg', 'header-bg-03.jpg', 'header-bg-04.jpg'];
      $('#page-header--random-bg').css({'background-image': 'url(/assets/images/core/' + images[Math.floor(Math.random() * images.length)] + ')'});
    });
  </script>
</head>


  <body>

    <header class="page-header" id="page-header--random-bg">
  <div class="navigation-items">
    <div itemscope itemtype="http://schema.org/Organization">
      <span style="display: none;" itemprop="name">University of Bristol Computer Science Society</span>
      <a aria-label="Home" href="http://www.cssbristol.co.uk" class="page-header__logo" itemprop="url">
        <!-- <img src="/assets/images/core/logo-inline-light.png" alt="CSS Bristol logo" itemprop="logo"> -->
      </a>
    </div>
    <nav class="page-navigation">
      <ul class="page-navigation__links">
        
          
        
          
          <li><a href="/about/">About</a></li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <li><a href="/contact/">Contact</a></li>
          
        
          
        
          
          <li><a href="/events/">Events</a></li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <li><a href="/jobs/">Jobs</a></li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <li><a href="/tutorials/">Tutorials</a></li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <li><a href="/wellbeing/">Wellbeing</a></li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
  
</header>


    <section class="page-section">
  <article class="article">
    <h1 id="bundler">Bundler</h1>

<p>На сайте вам нужны некоторые дополнительные файлы (например, JS или CSS) на каждой странице. Для разных страниц нужны разные файлы, но некоторые файлы нужны сразу на нескольких страницах. Вы можете объединить несколько файлов в один ‘бандл’.</p>

<p>Пользовательский браузер использует кеш, так что бандлы, которые уже загружены, повторо загружаться не будут. Например, если Вы сольете все файлы с сайта в один бандл, то он загрузится при посещении первой страницы, и остальные страницы буду загружаться быстрее.</p>

<p>Но, если пользователь, например, зайдет только на одну страницу сайта, то такой метод приведет к сильному увеличению времени загрузки для этой конкретной страницы, что плохо.</p>

<p>Если не объединять ничего, то пользователю точно не придется загружать никаких лишних данных, но на каждой странице будет загружаться куча файлов, а это нехорошо.</p>

<p>Таким образом, нужен некоторый компромиссный вариант - что-то объединять, что-то нет. Этот модуль ищет такой вариант с помощью генетического программирования.</p>

<p>Считается, что время загрукзи страницы определяется количеством файлов и их размером, и нужно минимизировать среднее по всем пользователям время загрузки.</p>

<p>Кроме того, между файлами могут быть зависимости: файл2 может зависет от файла1, что означает, что на странице файл1 должен быть раньше чем файл2. Если найденный бандлинг не удовлетворяет зависимостям, то модуль об этом сообщает, но не пытается исправить ситуацию. Для более удобной работы с зависимостями есть “метафайлы”, которые не соответствуют реальным файлам, но могут иметь зависимости. Зависимости могут быть разными для разных страниц.</p>

<h2 id="формат-ввода-вывода">Формат ввода-вывода</h2>

<ul>
  <li>Данные по странице с названием ‘PAGE’ должны лежать в файле ‘PAGE.deps-sets.js’ в следующем формате:</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">depsSets</span> <span class="o">=</span> <span class="p">{</span>
	<span class="dl">"</span><span class="s2">file1</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
		<span class="dl">'</span><span class="s1">deps</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">file2</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">metafile1</span><span class="dl">'</span><span class="p">],</span>
		<span class="dl">'</span><span class="s1">size</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="dl">"</span><span class="s2">file2</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
		<span class="dl">'</span><span class="s1">deps</span><span class="dl">'</span><span class="p">:</span> <span class="p">[],</span>
		<span class="dl">'</span><span class="s1">size</span><span class="dl">'</span><span class="p">:</span> <span class="mi">666</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="dl">'</span><span class="s1">file3</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
		<span class="dl">'</span><span class="s1">deps</span><span class="dl">'</span><span class="p">:</span> <span class="p">[],</span>
		<span class="dl">'</span><span class="s1">size</span><span class="dl">'</span><span class="p">:</span> <span class="mi">13</span>
	<span class="p">},</span>
	<span class="dl">'</span><span class="s1">metafile1</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
		<span class="dl">'</span><span class="s1">deps</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">metafile2</span><span class="dl">'</span><span class="p">],</span>
	<span class="p">},</span>
	<span class="dl">'</span><span class="s1">metafile2</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
		<span class="dl">'</span><span class="s1">deps</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">file3</span><span class="dl">'</span><span class="p">],</span>
	<span class="p">},</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Что означает: страница состоит из 3х файлов ‘file1’, ‘file2’ и ‘file3’. Причем ‘file1’ зависит (после раскрытия зависимостей) от ‘file2’ и ‘file3’.
Метафайлы характеризуются тем, что для них не задано поле ‘size’.</p>

<p>Размер указывается в байтах.</p>

<ul>
  <li>Логи по сессиям должны быть в следующем формате:</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">sessions</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">[</span><span class="dl">'</span><span class="s1">user1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">page1</span><span class="dl">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
	<span class="p">[</span><span class="dl">'</span><span class="s1">user2</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">page2</span><span class="dl">'</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
	<span class="p">[</span><span class="dl">'</span><span class="s1">user1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">page3</span><span class="dl">'</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="p">];</span>
</code></pre></div></div>

<p>Где каждый элемент имеет формат [ID пользователя, посещенная страница, время визита (timestamp).</p>

<ul>
  <li>Запуск в следующем формате:</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>bundler [<strong>–file-cost</strong>=<em>FILE_COST</em>] [<strong>–kb-cost</strong>=<em>KB_COST</em>] [<strong>–max-pause</strong>=<em>MAX_PAUSE</em>] [<strong>–debug</strong>] <strong>-s</strong></td>
      <td><strong>–sessions</strong>=<em>SESSIONS</em> [<strong>-o</strong></td>
      <td><strong>–output</strong>=<em>OUTPUT</em>] <strong>page1.deps-sets.js</strong> <strong>page2.deps-sets.js</strong></td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>FILE_COST</strong> - стоимость загрузки одного файла в тугриках; по умолчанию 10.</li>
  <li><strong>KB_COST</strong> - стоимость загрузки одного килобайта в тугриках; по умолчанию 2.</li>
  <li><strong>MAX_PAUSE</strong> - время жизни сессии в секундах; по умолчанию 3600 (один час). Считается, что если юзер никуда не заходил в течении этого времени, то кеш сбрасывается.</li>
  <li><strong>–debug</strong> - выводит отладочную информацию: стоимости “наивных” бандлингов, стоимости лучших вариантов по поколениям, и т.д.</li>
  <li><strong>OUTPUT</strong> - файл для вывода результата; если не задан, или указан ‘-‘, то используется stdout. Учитывается только если не задан параметр ‘debug’.</li>
  <li><strong>SESSIONS</strong> - модуль с сессиями в оговоренном формате.</li>
  <li>
    <p><strong>page.deps-sets.js</strong> - файлы с данными по страницам. HINT: если они лежат в одной директории и Вы используете, например, bash, то можно указывать pages/*.</p>
  </li>
  <li>Формат вывода (при выключенном режиме отладки):</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">bundling</span> <span class="o">=</span> <span class="p">{</span>
	<span class="dl">"</span><span class="s2">bundles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
		<span class="p">[</span><span class="dl">'</span><span class="s1">file1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">file2</span><span class="dl">'</span><span class="p">],</span>
		<span class="p">[</span><span class="dl">'</span><span class="s1">file1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">file3</span><span class="dl">'</span><span class="p">],</span>
		<span class="p">[</span><span class="dl">'</span><span class="s1">file4</span><span class="dl">'</span><span class="p">],</span>
	<span class="p">],</span>
	<span class="dl">"</span><span class="s2">pages</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
		<span class="dl">"</span><span class="s2">page1</span><span class="dl">"</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
		<span class="dl">"</span><span class="s2">page2</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
		<span class="dl">"</span><span class="s2">page3</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Бандлы выводятся в таком порядке, чтобы не были нарушены зависимости.
Если найденный бандлинг невозможно упорядочить с удовлетворением зависимостей - скрипт бросает исключение ‘Bundles are not consistent’.</p>

<h2 id="api">API</h2>
<p>Модуль <strong>bundler.js</strong> предоставляет функцию <code class="language-plaintext highlighter-rouge">get_bundling(config, args, main_generator, return_result)</code>.
<em>config</em> - это объект следующего вида:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">sessions</span><span class="p">:</span> <span class="p">[...],</span>
	<span class="na">file_cost</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
	<span class="na">kb_cost</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="na">max_pause</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
	<span class="na">output</span><span class="p">:</span> <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Опции соответствуют опциям при запуске из командной строки, только sessions должно быть массивом, а не файлом, и output должен быть объектом файла.
<em>args</em> - список страниц в виде</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
	<span class="p">[</span><span class="dl">'</span><span class="s1">page1</span><span class="dl">'</span><span class="p">,</span> <span class="nx">depsSets1</span><span class="p">],</span>
	<span class="p">[</span><span class="dl">'</span><span class="s1">page2</span><span class="dl">'</span><span class="p">,</span> <span class="nx">depsSets2</span><span class="p">],</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Где <em>depsSets</em> - объекты в описанном выше формате.
<em>main_generator</em> - может быть <em>mega</em> для запуска генетического алгоритма, или <em>all</em>, <em>none</em>, <em>every</em> для получения “наивного” результата. <em>all</em> - слить все файлы в один бандл, <em>none</em> - каждый файл соответствует бандлу, <em>every</em> - для каждый страницы свой один бандл, содержащий в точности файлы с этой страницы.
Если <em>return_result</em> истинно, то вместо вывода результата работы он возвращается в виде словаря с полями <em>cost</em> и <em>bundling</em>.</p>

  </article>
</section>


    <section class="page-section sponsorsec">
    <h1><a href="/pages/sponsors">Our lovely sponsors</a></h1>
    <div class="sponsors">
      
        <a class="sponsors__item" href="https://www.bloomberg.com/careers/technology/engineering/" title="Bloomberg" target="_blank">
          <img src="/assets/images/contrib/sponsors/bloomberg.png" alt="Bloomberg logo">
        </a>
      
        <a class="sponsors__item" href="https://www.tpp-uk.com" title="TPP" target="_blank">
          <img src="/assets/images/contrib/sponsors/tpp.png" alt="TPP logo">
        </a>
      
        <a class="sponsors__item" href="https://www.optiver.com" title="Optiver" target="_blank">
          <img src="/assets/images/contrib/sponsors/optiver.svg" alt="Optiver logo">
        </a>
      
        <a class="sponsors__item" href="https://www.visa.co.uk/" title="Visa" target="_blank">
          <img src="/assets/images/contrib/sponsors/visa.webp" alt="Visa logo">
        </a>
      
        <a class="sponsors__item" href="https://pilgrim.co.uk/" title="Pilgrim Brewery" target="_blank">
          <img src="/assets/images/contrib/sponsors/pilgrim.png" alt="Pilgrim Brewery logo">
        </a>
      
    </div>
    <div class="sponsors__action_item">
      <h2>This could be you!</h2>
      <p><a class="btn" href="/pages/sponsors">Get in touch</a></p>
    </div>
</section>


    <footer class="page-footer">
  <span class="page-footer__text">&copy; University of Bristol Computer Science Society</span>
  <nav class="page-footer__menu">
    <ul>
    
      
    
      
      <li>
        <a class="page-link" href="/about/">About</a>
      </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      <li>
        <a class="page-link" href="/contact/">Contact</a>
      </li>
      
    
      
    
      
      <li>
        <a class="page-link" href="/events/">Events</a>
      </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      <li>
        <a class="page-link" href="/jobs/">Jobs</a>
      </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      <li>
        <a class="page-link" href="/tutorials/">Tutorials</a>
      </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      <li>
        <a class="page-link" href="/wellbeing/">Wellbeing</a>
      </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
  </nav>
  <!--
  <section class="page-footer__sponsors">
    
  </section>
  <section class="page-footer__socials">
  </section>
  --!>
</footer>


  </body>

</html>
